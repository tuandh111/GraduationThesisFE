<!DOCTYPE html>
<html lang="en" ng-app="dentisHub">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Nha khoa Tooth Teeth</title>
  <link rel="icon" href="/assets/images/logo2.jpg" type="image/png">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">

  <!-- jQuery UI Smoothness theme -->
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css">

  <!-- Bootstrap Icons CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap5.min.css">

  <!-- SweetAlert2 CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.15.7/dist/sweetalert2.min.css">

  <!-- Other custom stylesheets -->
  <link rel="stylesheet" href="/assets/plugins/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="/assets/plugins/icofont/icofont.min.css">
  <link rel="stylesheet" href="/assets/plugins/slick-carousel/slick/slick.css">
  <link rel="stylesheet" href="/assets/plugins/slick-carousel/slick/slick-theme.css">
  <link rel="stylesheet" href="/assets/css/admin/simplebar.css">
  <link rel="stylesheet" href="/assets/css/admin/feather.css">

  <link rel="stylesheet" href="https://fullcalendar.io/releases/core/4.1.0/main.min.css">
  <link rel="stylesheet" href="https://fullcalendar.io/releases/timeline/4.1.0/main.min.css">
  <link rel="stylesheet" href="https://fullcalendar.io/releases/resource-timeline/4.1.0/main.min.css">


  <!-- <link rel="stylesheet" href="/assets/css/admin/fullcalendar.css"> -->
  <link rel="stylesheet" href="/assets/css/admin/select2.css">
  <link rel="stylesheet" href="/assets/css/admin/dropzone.css">
  <link rel="stylesheet" href="/assets/css/admin/uppy.min.css">
  <link rel="stylesheet" href="/assets/css/admin/jquery.steps.css">
  <link rel="stylesheet" href="/assets/css/admin/jquery.timepicker.css">
  <link rel="stylesheet" href="/assets/css/admin/quill.snow.css">
  <link rel="stylesheet" href="/assets/css/admin/daterangepicker.css">
  <link rel="stylesheet" href="/assets/css/admin/app-light.css" id="lightTheme">
  <link rel="stylesheet" href="/assets/css/admin/app-dark.css" id="darkTheme" disabled>
  <link rel="stylesheet" href="/assets/css/admin/custom-admin-list-appoinment.css">
  <link rel="stylesheet" href="/assets/css/admin/custom-admin-calendar.css">
  <link rel="stylesheet" href="/assets/css/loading-indicator.css">
  <link rel="stylesheet" href="/assets/css/admin/custom-admin-doctor-schedule.css">
  <link rel="stylesheet" href="/assets/css/admin/custom-admin-patient-record.css">
  <link rel="stylesheet" href="/assets/css/admin/custom-doctor-calendar.css">
  <link rel="stylesheet" href="/assets/css/admin/custom-admin-create-account.css">
  <link rel="stylesheet" href="/assets/css/style.css">

  <!-- Notification -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/noty@3.1.4/lib/noty.css">

  <!-- AngularJS -->
  <script src="/assets/js/vendor/angular.min.js"></script>
  <script src="/assets/js/vendor/angular-route.min.js"></script>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

  <!-- jQuery UI -->
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

  <!-- Moment.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.34/moment-timezone-with-data.min.js"></script>

  <!-- Notification -->
  <script src="https://cdn.jsdelivr.net/npm/noty@3.1.4/lib/noty.min.js"></script>


</head>

<body id="top">
  <!-- <loading-indicator></loading-indicator> -->
  <main class="site-main" ng-class="{ 'blur-content': isLoading }">
    <ng-view></ng-view>
  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <!-- SweetAlert2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.15.7/dist/sweetalert2.min.js"></script>

  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
    integrity="sha512-qZvrmS2ekKPF2mSznTQsxqPgnpkI4DNTlrdUmTzrDgektczlKNRRhy5X5AAOnx5S09ydFYWWNSfcEqDTTHgtNA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.70/pdfmake.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- Other JavaScript files -->
  <!-- <script src="/assets/js/admin/jquery.min.js"></script> -->
  <script src="/assets/js/admin/tooltip.min.js"></script>
  <script src="/assets/plugins/bootstrap/js/popper.js"></script>
  <script src="/assets/js/admin/popper.min.js"></script>
  <script src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js">
  </script>
  <script src="/assets/plugins/slick-carousel/slick/slick.min.js"></script>
  <script src="/assets/plugins/counterup/jquery.waypoints.min.js"></script>
  <script src="/assets/plugins/counterup/jquery.counterup.min.js"></script>
  <script src="/assets/plugins/shuffle/shuffle.min.js"></script>
  <script src="/assets/plugins/google-map/map.js"></script>
  <script src="/assets/js/admin/simplebar.min.js"></script>
  <script src="/assets/js/admin/daterangepicker.js"></script>
  <script src="/assets/js/admin/jquery.stickOnScroll.js"></script>
  <script src="/assets/js/admin/tinycolor-min.js"></script>
  <script src="/assets/js/admin/config.js"></script>
  <script src='/assets/js/admin/jquery.dataTables.min.js'></script>
  <script src='/assets/js/admin/dataTables.bootstrap4.min.js'></script>
  <script src="/assets/js/admin/d3.min.js"></script>
  <script src="/assets/js/admin/topojson.min.js"></script>
  <script src="/assets/js/admin/datamaps.all.min.js"></script>
  <script src="/assets/js/admin/datamaps-zoomto.js"></script>
  <script src="/assets/js/admin/datamaps.custom.js"></script>
  <script src="/assets/js/admin/Chart.min.js"></script>
  <script>
    Chart.defaults.global.defaultFontFamily = base.defaultFontFamily;
    Chart.defaults.global.defaultFontColor = colors.mutedColor;
  </script>
  <script src="/assets/js/admin/gauge.min.js"></script>
  <script src="/assets/js/admin/jquery.sparkline.min.js"></script>
  <script src="/assets/js/admin/apexcharts.min.js"></script>
  <script src="/assets/js/admin/apexcharts.custom.js"></script>

  <script src='/assets/js/admin/index.global.js'></script>

  <script src='/assets/js/admin/fullcalendar-core.js'></script>
  <script src='/assets/js/admin/fullcalendar-interaction.js'></script>
  <script src='/assets/js/admin/fullcalendar-timeline.js'></script>
  <script src='/assets/js/admin/fullcalendar-resource-common.js'></script>
  <script src='/assets/js/admin/fullcalendar-resource-timeline.js'></script>

  <!-- <script src='/assets/js/admin/fullcalendar.js'></script>
  <script src='/assets/js/admin/fullcalendar.custom.js'></script> -->

  <script src='/assets/js/admin/jquery.mask.min.js'></script>
  <script src='/assets/js/admin/select2.min.js'></script>
  <script src='/assets/js/admin/jquery.steps.min.js'></script>
  <script src='/assets/js/admin/jquery.validate.min.js'></script>
  <script src='/assets/js/admin/jquery.timepicker.js'></script>
  <script src='/assets/js/admin/dropzone.min.js'></script>
  <script src='/assets/js/admin/uppy.min.js'></script>
  <script src='/assets/js/admin/quill.min.js'></script>
  <script src="/assets/js/app/app.js"></script>
  <script src="/assets/js/admin/apps-admin.js"></script>
  <script src="/assets/js/app/adminDashboardController.js"></script>
  <script src="/assets/js/app/adminListAppoinment.js"></script>
  <script src="/assets/js/app/adminListService.js"></script>
  <script src="/assets/js/app/adminDoctorController.js"></script>
  <script src="/assets/js/app/adminDoctorScheduleController.js"></script>
  <script src="/assets/js/app/adminCalendar.js"></script>
  <script src="/assets/js/app/adminShiftController.js"></script>
  <script src="/assets/js/app/adminDentalStaffController.js"></script>
  <script src="/assets/js/app/adminPatientController.js"></script>
  <script src="/assets/js/app/adminMedicineController.js"></script>
  <script src="/assets/js/app/bookingController.js"></script>
  <script src="/assets/js/app/blogController.js"></script>
  <script src="/assets/js/app/serviceController.js"></script>
  <script src="/assets/js/app/departmentController.js"></script>
  <script src="/assets/js/app/doctorController.js"></script>
  <script src="/assets/js/app/customerProfileController.js"></script>
  <script src="/assets/js/app/customerRecoredController.js"></script>
  <script src="/assets/js/app/headerController.js"></script>
  <script src="/assets/js/app/adminListDentalSuppliesController.js"></script>
  <script src="/assets/js/app/adminListDistributionSuppliesController.js"></script>

  <script src="/assets/js/app/adminListInvoice.js"></script>
  <script src="/assets/js/app/transactionSuccessController.js"></script>
  <script src="/assets/js/app/adminCTResultController.js"></script>
  <script src="/assets/js/app/adminPatientRecord.js"></script>
  <script src="/assets/js/app/adminDoctorCalendarController.js"></script>
  <script src="/assets/js/app/adminCreateAccountController.js"></script>
  <script src="/assets/js/app/adminPostController.js"></script>
  <script src="/assets/js/app/adminNotifications.js"></script>
  <script src="/assets/js/app/adminSideBarController.js"></script>

  <script src="/assets/js/app/loginController.js"></script>
  <script src="/assets/js/app/registerController.js"></script>
  <script src="/assets/js/app/forgotPasswordController.js"></script>


  <script src="/assets/js/app/adminMyProfileController.js"></script>
  <script src="/assets/js/app/adminMySettingController.js"></script>
  <script>
    function getParameterByName(name, url = window.location.href) {
      name = name.replace(/[\[\]]/g, '\\$&');
      let regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }
    function getCookie(name) {
      let value = `; ${document.cookie}`;
      let parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
      return null;
    }
    let code = getParameterByName('code');
    let loginSource = getCookie('loginSource');
    // console.log(loginSource)
    if (code) {
      // Hàm lấy tham số từ URL
      function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
        const results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
      }

      // Hàm lấy giá trị cookie theo tên
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) {
          return parts.pop().split(';').shift();
        }
        return null;
      }

      // Lấy mã code từ URL và nguồn đăng nhập từ cookie
      const code = getParameterByName('code');
      const loginSource = getCookie('loginSource');
      // console.log('Login source:', loginSource);

      if (code) {
        async function handleGoogleCallback(code) {
          try {
            const response = await fetch('http://localhost:8081/api/v1/auth/google/callback', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ code: code })
            });
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            localStorage.setItem('accessToken', data.access_token);
            localStorage.setItem('refreshToken', data.refresh_token);
            localStorage.setItem('isLogin', true)
            let userString = ""
            if (data.user.role.roleName == 'BENH_NHAN') {
              userString = data.user.patient.patientId + '-' + data.user.role.roleName + '-' + data.user.email;
            } else if (data.user.role.roleName == 'BAC_SI') {
              userString = data.user.doctor.doctorId + '-' + data.user.role.roleName + '-' + data.user.email;
            } else {
              userString = data.user.dentalStaff.dentalStaffId + '-' + data.user.role.roleName + '-' + data.user.email;
            }
            localStorage.setItem('userLogin', userString);
            // console.log(localStorage.getItem('userLogin'))
            window.location.replace('http://localhost:5501/index.html');
          } catch (error) {
            Swal.fire({
              title: "Lỗi!",
              html: "Tài khoản của bạn đã bị vô hiệu hóa. Vui lòng liên hệ với nha khoa !",
              icon: "error"
            }).then(rp => {
              if (rp.isConfirmed) {
                window.location.href = "#!login";
              }
            })
          }
        }
        handleGoogleCallback(code);
      }

    }
    // console.log(localStorage.getItem('userLogin'))
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</body>

</html>