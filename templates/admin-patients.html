<div class="vertical  dark ">
    <div class="wrapper">
        <nav class="topnav navbar navbar-light justify-content-end" ng-include="'component/admin-nav.html'">
        </nav>
        <aside class="sidebar-left border-right shadow" id="leftSidebar" ng-include="'component/admin-aside.html'"
            data-simplebar>
        </aside>
        <main role="main" class="main-content" ng-controller="AdminPatientController">
            <div class="container-fluid">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                    </ol>
                </nav>
                <div class="row justify-content-center mb-3">
                    <div class="d-flex flex-items-center flex-justify-between custom-heading">
                        <h3 class="text-secondary">Quản lý thông tin bệnh nhân</h3>
                    </div>
                    <div class="custom-hr"></div>
                </div>
                <div class="row justify-content-center">
                    <div class="col-12">
                        <p class="card-text"></p>
                        <div class="row my-4">
                            <!-- Small table -->
                            <div class="col-md-12">
                                <div class="card shadow">
                                    <div class="card-body">
                                        <!-- tabbb -->
                                        <ul class="nav nav-pills mb-3" id="managePatients" role="tablist">
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link active" id="form-tab-patient"
                                                    data-bs-toggle="tab" data-bs-target="#form-tab-pane-manage-patients"
                                                    type="button" role="tab"
                                                    aria-controls="form-tab-pane-manage-patients" aria-selected="true">
                                                    <i class="bi bi-pencil-square"></i> Quản lý
                                                </button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="list-tab-patient" data-bs-toggle="tab"
                                                    data-bs-target="#list-tab-pane-patient" role="tab"
                                                    aria-controls="list-tab-pane-patient" aria-selected="false">
                                                    <i class="bi bi-list-check"></i> Danh sách
                                                </button>
                                            </li>
                                        </ul>
                                        <div class="tab-content" id="managePatientsTabContent">
                                            <div class="tab-pane fade show active" id="form-tab-pane-manage-patients"
                                                role="tabpanel" aria-labelledby="form-tab-patient" tabindex="0">
                                                <div class="row align-items-center justify-content-center">
                                                    <div class="col-lg col-sm-12 p-3 me-3 d-flex flex-column flex-wrap">
                                                        <div class="row">
                                                            <div class="col-lg-6 col-md-12">
                                                                <div class="form-outline mb-3">
                                                                    <label class="form-label"
                                                                        for="managePatientsModalpatientsName">Tên Bệnh
                                                                        nhân</label>
                                                                    <input type="text"
                                                                        id="managePatientsModalpatientsName"
                                                                        ng-model="formPatient.fullName"
                                                                        class="form-control" placeholder="Tên bệnh nhân"
                                                                        required>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6 col-md-12">
                                                                <div class="form-outline mb-3">
                                                                    <label class="form-label"
                                                                        for="managePatientsModalpatientsPhoneNumber">Số
                                                                        điện thoại</label>
                                                                    <input type="text"
                                                                        id="managePatientsModalpatientsPhoneNumber"
                                                                        ng-model="formPatient.phoneNumber"
                                                                        class="form-control"
                                                                        placeholder="Nhập số điện thoại">
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6 col-md-12">
                                                                <div class="form-outline mb-3">
                                                                    <label class="form-label"
                                                                        for="managePatientsModalpatientsCitizenIdentificationNumber">Số
                                                                        CMND/CCCD</label>
                                                                    <input type="text"
                                                                        id="managePatientsModalpatientsCitizenIdentificationNumber"
                                                                        ng-model="formPatient.citizenIdentificationNumber"
                                                                        class="form-control"
                                                                        placeholder="Nhập số CMND/CCCD">
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6 col-md-12">
                                                                <div class="form-outline mb-3">
                                                                    <label class="form-label"
                                                                        for="managePatientsModalpatientsBirthday">Ngày
                                                                        sinh</label>
                                                                    <input type="date"
                                                                        id="managePatientsModalpatientsBirthday"
                                                                        ng-model="formPatient.birthday"
                                                                        class="form-control" placeholder="Ngày sinh">
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6 col-md-12">
                                                                <div class="form-outline mb-3">
                                                                    <label class="form-label"
                                                                        for="managePatientsModalpatientsGender">Giới
                                                                        tính</label>
                                                                    <select id="managePatientsModalpatientsGender"
                                                                        class="form-control select2"
                                                                        ng-model="formPatient.gender"
                                                                        ng-options="d.genderId as d.genderName for d in listGenderTypeDB">
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6 col-md-12">
                                                                <div class="form-outline mb-3">
                                                                    <label class="form-label"
                                                                        for="managePatientsModalMedicalHistory">Tiền sử
                                                                        bệnh lý</label>
                                                                    <select id="managePatientsModalMedicalHistory"
                                                                        class="form-control select2-multi"
                                                                        ng-model="formPatient.medicalHistories"
                                                                        ng-options="m as m.name for m in listMedicalHistoryDB">
                                                                    </select>
                                                                </div>
                                                                <div class="form-row"
                                                                    ng-show="listMedicalHistoriesOfPatient.length!=0">
                                                                    <p>Hồ sơ bệnh lý đã lưu</p>
                                                                    <ul>
                                                                        <li
                                                                            ng-repeat="mh in listMedicalHistoriesOfPatient">
                                                                            {{mh.medicalHistoryId +"-"+mh.name
                                                                            }}</li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                            <!-- <div class="col-lg-6 col-md-12">
                                                                <div class="form-outline mb-3">
                                                                    <div ng-if="medicalHistoriesSelections.length > 0">
                                                                        <label>Các bệnh lý đã chọn:</label><br>
                                                                        <div
                                                                            ng-repeat="item in medicalHistoriesSelections">
                                                                            <input disabled
                                                                                class="medicalHistoryChecked"
                                                                                value="item" type="checkbox"
                                                                                ng-click="updateSelection(item)"
                                                                                ng-checked="true">
                                                                            {{showHistorySelected(item)}}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div> -->
                                                        </div>
                                                        <div class="d-flex justify-content-center mt-3">
                                                            <button ng-click="createPatient()"
                                                                class="btn btn-success m-2"
                                                                ng-show="!isUpdatePatient&&!isLoadingCreate">Tạo
                                                                mới</button>
                                                            <button class="btn btn-outline-success" type="button"
                                                                disabled ng-show="isLoadingCreate">
                                                                <span class="spinner-border spinner-border-sm"
                                                                    role="status" aria-hidden="true"></span>
                                                                Đang xử lý...
                                                            </button>
                                                            <button ng-click="updatePatient()"
                                                                class="btn btn-primary m-2"
                                                                ng-show="isUpdatePatient&&!isLoadingUpdate">Cập
                                                                nhật</button>
                                                            <button class="btn btn-outline-primary" type="button"
                                                                disabled ng-show="isLoadingUpdate">
                                                                <span class="spinner-border spinner-border-sm"
                                                                    role="status" aria-hidden="true"></span>
                                                                Đang xử lý...
                                                            </button>
                                                            <button ng-click="resetForm()" class="btn btn-info m-2">Làm
                                                                mới</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="list-tab-pane-patient" role="tabpanel"
                                                aria-labelledby="list-tab-patient" tabindex="0">
                                                <div class="card p-3">
                                                    <table class="table datatables" id="dataTable-list-patient">
                                                        <thead>
                                                            <tr>
                                                                <th>Mã bệnh nhân</th>
                                                                <!-- <th>Ảnh</th> -->
                                                                <th>Tên bệnh nhân</th>
                                                                <th>Điện thoại</th>
                                                                <th>Số CMND/CCCD</th>
                                                                <th>Giới tính</th>
                                                                <th>Ngày sinh</th>
                                                                <th>Tiền sử bệnh</th>
                                                                <th>Thao tác</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr ng-repeat="p in listPatientDB">
                                                                <td>{{p.patientId}}</td>
                                                                <!-- <td>{{p.imageURL}}</td> -->
                                                                <td>{{p.fullName}}</td>
                                                                <td>{{p.phoneNumber}}</td>
                                                                <td>{{p.citizenIdentificationNumber}}</td>
                                                                <td>{{getGenderText(p.gender)}}</td>
                                                                <td>{{formatDate(p.birthday)}}</td>
                                                                <td>
                                                                    <ul>
                                                                        <li
                                                                            ng-repeat="mh in showMedicalHistories(p.patientId)">
                                                                            {{mh.medicalHistory.name}}
                                                                        </li>
                                                                    </ul>
                                                                </td>
                                                                <td>
                                                                    <button
                                                                        class="btn btn-sm dropdown-toggle more-horizontal"
                                                                        type="button" data-toggle="dropdown"
                                                                        aria-haspopup="true" aria-expanded="false">
                                                                        <span class="text white">...</span>
                                                                    </button>
                                                                    <div class="dropdown-menu dropdown-menu-right"
                                                                        style="box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5); border-radius: 10px;">
                                                                        <a class="dropdown-item text-primary"
                                                                            ng-click="editPatient(p, $event)" href="#"
                                                                            style="font-size: 18px;">Sửa</a>
                                                                        <a class="dropdown-item text-danger"
                                                                            ng-click="deletePatient(p, $event)" href="#"
                                                                            style="font-size: 18px;">Xóa</a>
                                                                        <a class="dropdown-item text-info"
                                                                            ng-click="historyTreatmentPatient(p, $event)"
                                                                            href="#" style="font-size: 18px;">Lịch sử
                                                                            điều
                                                                            trị</a>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div> <!-- simple table -->
                        </div> <!-- end section -->
                    </div> <!-- .col-12 -->
                </div> <!-- .row -->
            </div> <!-- .container-fluid -->

            <!-- Modal Structure -->
            <div class="modal fade" id="treatmentHistoryModal" tabindex="-1" role="dialog"
                aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-xl" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Lịch sử điều trị</h5>
                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="false">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">

                            <div ng-show="listAppGroupByDateDB.length==0" class="text-warning text-center">Không có
                                dữ liệu hiển
                                thị</div>

                            <div class="">
                                <table class="table datatables" id="dataTable-customer-recorded">
                                    <thead>
                                        <tr>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="map in listAppGroupByDateDB">
                                            <td>
                                                <h6 class="text-uppercase text-muted mb-4 mt-4">{{map[0] |
                                                    dateFormat}}</h6>

                                                <div class="pb-3 timeline-item" ng-repeat="app in map[1]" ng-class="
                                  {
                                    'item-confirmed': app.appointmentStatus.status=='Đã Xác Nhận',
                                    'item-completed': app.appointmentStatus.status=='Hoàn Thành',
                                    'item-progress': app.appointmentStatus.status=='Đang Diễn Ra',
                                    'item-canceled': app.appointmentStatus.status=='Đã Hủy',
                                    'item-noshow': app.appointmentStatus.status=='Không Đến',
                                    'item-rescheduled': app.appointmentStatus.status=='Hoãn',
                                    'item-booked': app.appointmentStatus.status=='Đã Đặt'
                                  }" style="border: 1px solid rgb(221, 215, 215); margin: 0; border-radius: 5px;">
                                                    <div class="pl-5">
                                                        <div class="mb-3">
                                                            Khách hàng <strong>{{app.patient.fullName}}</strong>
                                                            <span class="text-muted mx-2">đã
                                                                {{app.appointmentStatus.status}} cuộc hẹn</span>
                                                            <strong>#{{app.appointmentId}}</strong>

                                                            <div>
                                                                <button class="btn btn-outline-danger float-right"
                                                                    style="margin: 5px;"
                                                                    ng-show="isShowBtnCancel(app.appointmentStatus.status)&&!isLoadingCancel(app.appointmentId)"
                                                                    ng-click="cancelAppoinmnet(app)">Hủy cuộc
                                                                    hẹn</button>
                                                                <button class="btn btn-outline-danger float-right"
                                                                    style="margin: 5px;" type="button" disabled
                                                                    ng-show="isShowBtnCancel(app.appointmentStatus.status)&&isLoadingCancel(app.appointmentId)">
                                                                    <span class="spinner-border spinner-border-sm"
                                                                        role="status" aria-hidden="true"></span>
                                                                    Đang xử lý...
                                                                </button>
                                                                <button id="btn-paintient-record-details"
                                                                    class="float-right btn btn-outline-primary"
                                                                    href="#!" style="margin: 5px;"
                                                                    data-bs-toggle="offcanvas"
                                                                    data-bs-target="#offcanvasDetails-{{app.appointmentId}}"
                                                                    aria-controls="offcanvasDetails-{{app.appointmentId}}"
                                                                    ng-click="setupTab(app)">Xem
                                                                    chi tiết</button>
                                                            </div>

                                                            <div style="height: 90vh;"
                                                                class="offcanvas offcanvas-bottom" tabindex="-1"
                                                                id="offcanvasDetails-{{app.appointmentId}}"
                                                                aria-labelledby="offcanvasBottomLabel">
                                                                <div class="offcanvas-header">
                                                                    <h5 class="offcanvas-title"
                                                                        id="offcanvasBottomLabel">Xem chi tiết bệnh
                                                                        án
                                                                        {{app.appointmentPatientRecord.appointmentPatientRecordId}}
                                                                    </h5>
                                                                    <button type="button" class="btn-close text-reset"
                                                                        data-bs-dismiss="offcanvas"
                                                                        aria-label="Close"></button>
                                                                </div>
                                                                <div class="offcanvas-body">
                                                                    <ul class="nav nav-tabs nav-justified mb-3"
                                                                        id="nav-tabs-{{app.appointmentId}}">
                                                                        <li class="nav-item">
                                                                            <a class="nav-link"
                                                                                ng-class="{active: isSelected(-1)}"
                                                                                ng-click="selectTab(-1,$event)">Thông
                                                                                tin
                                                                                bệnh nhân</a>
                                                                        </li>
                                                                        <li class="nav-item">
                                                                            <a class="nav-link"
                                                                                ng-class="{active: isSelected(-2)}"
                                                                                ng-click="selectTab(-2,$event)"
                                                                                href="#">Xem hóa
                                                                                đơn</a>
                                                                        </li>
                                                                        <li class="nav-item">
                                                                            <a class="nav-link"
                                                                                ng-class="{active: isSelected(-3)}"
                                                                                ng-click="selectTab(-3,$event)"
                                                                                href="#">Đơn
                                                                                thuốc</a>
                                                                        </li>
                                                                    </ul>
                                                                    <div class="tab-content">
                                                                        <div class="tab-pane"
                                                                            ng-class="{ 'active show': isSelected(-1) }"
                                                                            ng-init="details = getDetailsAppointment(app.appointmentId)">

                                                                            <div class="row justify-content-center">
                                                                                <div class="col-12">
                                                                                    <div
                                                                                        class="row mt-2 align-items-center">
                                                                                        <div
                                                                                            class="col-md-3 text-center mb-5">
                                                                                            <div
                                                                                                class="avatar avatar-xl">
                                                                                                <img ng-src="{{app.patient.imageURL}}"
                                                                                                    alt="..."
                                                                                                    class="avatar-img rounded-circle">
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="col">
                                                                                            <div
                                                                                                class="row align-items-center">
                                                                                                <div class="col-md-7">
                                                                                                    <h4 class="mb-1">
                                                                                                        {{app.patient.fullName}}
                                                                                                    </h4>
                                                                                                    <p class="mb-3">
                                                                                                        <span
                                                                                                            class="badge badge-dark">ID:
                                                                                                            {{app.patient.patientId
                                                                                                            }}</span>
                                                                                                    </p>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="row mb-4">
                                                                                                <div class="col-md-7">
                                                                                                    <p class="mb-0 text-secondary"
                                                                                                        ng-show="app.patient.gender==='MALE'">
                                                                                                        Giới
                                                                                                        tính: Nam
                                                                                                    </p>
                                                                                                    <p class="mb-0 text-secondary"
                                                                                                        ng-show="app.patient.gender==='FEMALE'">
                                                                                                        Giới
                                                                                                        tính: Nữ
                                                                                                    </p>
                                                                                                    <p class="mb-0 text-secondary"
                                                                                                        ng-show="app.patient.gender!=='FEMALE'&&app.patient.gender!=='MALE'">
                                                                                                        Giới tính:
                                                                                                        Khác </p>
                                                                                                    <p
                                                                                                        class="mb-0 text-secondary">
                                                                                                        CMND/CCCD:
                                                                                                        {{app.patient.citizenIdentificationNumber}}
                                                                                                    </p>
                                                                                                    <p
                                                                                                        class="mb-0 text-secondary">
                                                                                                        Ngày sinh:
                                                                                                        {{app.patient.birthday
                                                                                                        |
                                                                                                        dateFormat
                                                                                                        }}</p>
                                                                                                </div>
                                                                                                <div class="col">
                                                                                                    <p
                                                                                                        class="mb-0 text-secondary">
                                                                                                        Địa chỉ:
                                                                                                        {{app.patient.address}}
                                                                                                    </p>
                                                                                                    <p
                                                                                                        class="mb-0 text-secondary">
                                                                                                        Điện thoại:
                                                                                                        {{app.patient.phoneNumber
                                                                                                        |
                                                                                                        phoneNumberFormat}}
                                                                                                    </p>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6">
                                                                                    <h6 class="mb-3">Chi tiết giờ
                                                                                        khám</h6>
                                                                                    <table class="table table-hover">
                                                                                        <thead>
                                                                                            <tr role="row">
                                                                                                <th>ID</th>
                                                                                                <th>Giờ bắt đầu khám
                                                                                                </th>
                                                                                                <th>Giờ kết thúc
                                                                                                    khám</th>
                                                                                            </tr>
                                                                                        </thead>
                                                                                        <tbody>
                                                                                            <tr
                                                                                                ng-repeat="d in getDetailsAppointment(app.appointmentId)">
                                                                                                <th>{{d.doctorUnavailabilityId}}
                                                                                                </th>
                                                                                                <td>{{d.timeOfShift.beginTime|timeFormat}}
                                                                                                </td>
                                                                                                <td>{{d.timeOfShift.endTime|timeFormat}}
                                                                                                </td>
                                                                                            </tr>
                                                                                        </tbody>
                                                                                    </table>
                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                        <div class="tab-pane"
                                                                            ng-class="{ 'active show': isSelected(-2) }">
                                                                            <div ng-show="bill.length==0"
                                                                                class="text-warning text-center">
                                                                                Không có bill hiển
                                                                                thị
                                                                            </div>
                                                                            <div ng-show="bill.length!=0"
                                                                                class="row justify-content-center">
                                                                                <div class="col-12 col-lg-10 col-xl-8">
                                                                                    <div class="row align-items-center">
                                                                                        <div class="col">
                                                                                            <h2 class="h5 page-title">
                                                                                                <small
                                                                                                    class="text-secondary text-uppercase">BILL</small><br />#{{bill[0].billId}}
                                                                                            </h2>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            <button type="button"
                                                                                                class="btn btn-secondary"
                                                                                                ng-click="exportPDF('pdfContentBill','bill',bill[0].billId)">Tải
                                                                                                Bill</button>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div id="pdfContentBill">
                                                                                        <div class="card shadow">
                                                                                            <div class="card-body p-5">
                                                                                                <div class="row mb-5">
                                                                                                    <div
                                                                                                        class="col-12 text-center mb-4">
                                                                                                        <img src="/assets/images/logo_tt.png"
                                                                                                            class="navbar-brand-img mx-auto mb-4"
                                                                                                            alt="...">
                                                                                                        <h2
                                                                                                            class="mb-0 text-uppercase">
                                                                                                            Hóa Đơn
                                                                                                        </h2>
                                                                                                        <p
                                                                                                            class="text-secondary">
                                                                                                            Ngày:
                                                                                                            {{bill[0].createAt
                                                                                                            |
                                                                                                            dateFormat}}<br />
                                                                                                        </p>
                                                                                                    </div>
                                                                                                    <div
                                                                                                        class="col-md-7">
                                                                                                        <p
                                                                                                            class="small text-secondary text-uppercase mb-2">
                                                                                                            Phòng
                                                                                                            Khám Nha
                                                                                                            Khoa</p>
                                                                                                        <p class="mb-4">
                                                                                                            <strong>Tooth
                                                                                                                Teeth</strong><br />
                                                                                                            Địa chỉ:
                                                                                                            51/A,
                                                                                                            3/2,
                                                                                                            Ninh
                                                                                                            Kiều,
                                                                                                            Cần
                                                                                                            Thơ<br />
                                                                                                            MST:
                                                                                                            180000111<br />
                                                                                                            (84)
                                                                                                            0969 281
                                                                                                            254<br />
                                                                                                        </p>
                                                                                                        <p>
                                                                                                            <span
                                                                                                                class="small text-secondary text-uppercase">Hóa
                                                                                                                đơn
                                                                                                                số
                                                                                                                #</span><br />
                                                                                                            <strong>{{bill[0].billId}}</strong>
                                                                                                        </p>
                                                                                                    </div>
                                                                                                    <div
                                                                                                        class="col-md-5">
                                                                                                        <p
                                                                                                            class="small text-secondary text-uppercase mb-2">
                                                                                                            Khách
                                                                                                            hàng</p>
                                                                                                        <p class="mb-4">
                                                                                                            <strong>{{bill[0].appointments.patient.fullName}}</strong>
                                                                                                            <br />
                                                                                                            Địa chỉ:
                                                                                                            {{bill[0].appointments.patient.address}}<br />
                                                                                                            Số điện
                                                                                                            thoại:
                                                                                                            {{bill[0].appointments.patient.phoneNumber|phoneNumberFormat}}<br />
                                                                                                        </p>
                                                                                                        <p>
                                                                                                            <small
                                                                                                                class="small text-secondary text-uppercase">Hạn
                                                                                                                thanh
                                                                                                                toán</small><br />
                                                                                                            <strong>{{bill[0].createAt
                                                                                                                |
                                                                                                                dateFormat}}</strong>
                                                                                                        </p>
                                                                                                    </div>
                                                                                                </div>
                                                                                                <table
                                                                                                    class="table table-borderless table-striped">
                                                                                                    <thead>
                                                                                                        <tr>
                                                                                                            <th
                                                                                                                scope="col">
                                                                                                                #
                                                                                                            </th>
                                                                                                            <th
                                                                                                                scope="col">
                                                                                                                Tên
                                                                                                                dịch
                                                                                                                vụ
                                                                                                            </th>
                                                                                                            <th scope="col"
                                                                                                                class="text-right">
                                                                                                                Đơn
                                                                                                                giá
                                                                                                            </th>
                                                                                                            <th scope="col"
                                                                                                                class="text-right">
                                                                                                                Số
                                                                                                                lượng
                                                                                                            </th>
                                                                                                            <th scope="col"
                                                                                                                class="text-right">
                                                                                                                Thành
                                                                                                                tiền
                                                                                                            </th>
                                                                                                        </tr>
                                                                                                    </thead>
                                                                                                    <tbody>
                                                                                                        <tr
                                                                                                            ng-repeat="s in getAPSByAppointment(app.appointmentId,listAPSDB)">
                                                                                                            <th
                                                                                                                scope="row">
                                                                                                                {{s.appointment_ServiceId}}
                                                                                                            </th>
                                                                                                            <td>{{s.service.serviceName}}
                                                                                                            </td>
                                                                                                            <td
                                                                                                                class="text-right">
                                                                                                                {{s.service.price
                                                                                                                |
                                                                                                                formatPrice}}
                                                                                                            </td>
                                                                                                            <td
                                                                                                                class="text-right">
                                                                                                                {{s.quantity}}
                                                                                                            </td>
                                                                                                            <td
                                                                                                                class="text-right">
                                                                                                                {{s.service.price*s.quantity
                                                                                                                |
                                                                                                                formatPrice}}
                                                                                                            </td>
                                                                                                        </tr>
                                                                                                    </tbody>
                                                                                                </table>
                                                                                                <div class="row mt-5">
                                                                                                    <div
                                                                                                        class="col-2 text-center">
                                                                                                        <p hidden>
                                                                                                            temp</p>
                                                                                                    </div>
                                                                                                    <div
                                                                                                        class="col-md-5">
                                                                                                        <p hidden>
                                                                                                            temp</p>
                                                                                                    </div>
                                                                                                    <div
                                                                                                        class="col-md-5">
                                                                                                        <div
                                                                                                            class="text-right mr-2">

                                                                                                            <p
                                                                                                                class="mb-2 h6">
                                                                                                                <span
                                                                                                                    class="text-secondary">Tổng
                                                                                                                    thanh
                                                                                                                    toán
                                                                                                                    :
                                                                                                                </span>
                                                                                                                <span>{{getTotalService(app.appointmentId,listAPSDB)[0]
                                                                                                                    |
                                                                                                                    formatPrice}}</span>
                                                                                                            </p>

                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div class="col-12">
                                                                                                        <p
                                                                                                            class="mb-2 h6">
                                                                                                            <span
                                                                                                                class="text-secondary">Số
                                                                                                                tiền
                                                                                                                bằng
                                                                                                                chữ
                                                                                                                :
                                                                                                            </span>
                                                                                                            <span><em>{{getTotalService(app.appointmentId,listAPSDB)[1]}}</em></span>
                                                                                                        </p>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="tab-pane"
                                                                            ng-class="{ 'active show': isSelected(-3) }">
                                                                            <div ng-show="prescription.length==0"
                                                                                class="text-warning text-center">
                                                                                Không có
                                                                                đơn thuốc hiển
                                                                                thị
                                                                            </div>
                                                                            <div ng-show="prescription.length!=0"
                                                                                class="row justify-content-center">
                                                                                <div class="col-12 col-lg-10 col-xl-8">
                                                                                    <div id="pdfContentMedicine">
                                                                                        <div class="row mb-3">
                                                                                            <div class="col-md-7">
                                                                                                <p
                                                                                                    class="small text-uppercase mb-2">
                                                                                                    Phòng Khám Nha
                                                                                                    Khoa</p>
                                                                                                <p class="mb-4">
                                                                                                    <strong>Tooth
                                                                                                        Teeth</strong><br />
                                                                                                    Địa chỉ: 51/A,
                                                                                                    3/2, Ninh Kiều,
                                                                                                    Cần
                                                                                                    Thơ<br /> (84)
                                                                                                    0969 281
                                                                                                    254<br />
                                                                                                </p>
                                                                                            </div>
                                                                                            <div
                                                                                                class="col-5 text-center mb-4">
                                                                                                <img src="/assets/images/logo_tt.png"
                                                                                                    class="navbar-brand-img mx-auto mb-4"
                                                                                                    alt="...">
                                                                                                <h3
                                                                                                    class="mb-0 text-uppercase">
                                                                                                    Đơn thuốc
                                                                                                </h3> <span
                                                                                                    class="text-secondary">#{{prescription[0].prescription.prescriptionId}}</span>
                                                                                                <p>Ngày:
                                                                                                    {{app.appointmentDate|dateFormat}}
                                                                                                    <br />
                                                                                                </p>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="row mb-3">

                                                                                            <div class="col-12">
                                                                                                <p
                                                                                                    class="small text-uppercase mb-2">
                                                                                                    Khách hàng</p>
                                                                                                <div class="row">
                                                                                                    <div class="col-6">
                                                                                                        <strong>{{app.patient.fullName}}</strong>
                                                                                                    </div>
                                                                                                    <div class="col-6">
                                                                                                        <p
                                                                                                            class="small text-uppercase mb-2">
                                                                                                            Ngày
                                                                                                            sinh:
                                                                                                            {{app.patient.birthday|dateFormat}}
                                                                                                        </p>
                                                                                                    </div>
                                                                                                    <div class="col-6"
                                                                                                        ng-switch="app.patient.gender">
                                                                                                        <p class="small text-uppercase mb-2"
                                                                                                            ng-switch-when="FEMALE">
                                                                                                            Giới
                                                                                                            tính: Nữ
                                                                                                        </p>
                                                                                                        <p class="small text-uppercase mb-2"
                                                                                                            ng-switch-when="MALE">
                                                                                                            Giới
                                                                                                            tính:
                                                                                                            Nam</p>
                                                                                                        <p class="small text-uppercase mb-2"
                                                                                                            ng-switch-default>
                                                                                                            Giới
                                                                                                            tính:
                                                                                                            Khác</p>
                                                                                                    </div>
                                                                                                    <div class="col-6">
                                                                                                        <p
                                                                                                            class="small text-uppercase mb-2">
                                                                                                            Địa chỉ:
                                                                                                            {{app.patient.address}}
                                                                                                        </p>
                                                                                                    </div>
                                                                                                    <div class="col-6">
                                                                                                        <p
                                                                                                            class="small text-uppercase mb-2">
                                                                                                            Số điện
                                                                                                            thoại:
                                                                                                            {{app.patient.phoneNumber|phoneNumberFormat}}
                                                                                                        </p>
                                                                                                    </div>
                                                                                                    <div class="col-6">
                                                                                                        <p
                                                                                                            class="small text-uppercase mb-2">
                                                                                                            Mã hồ
                                                                                                            sơ:
                                                                                                            <strong>#{{prescription[0].prescription.appointmentPatientRecord.appointmentPatientRecordId}}</strong>
                                                                                                        </p>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="col-12">
                                                                                                <p>Chẩn đoán:
                                                                                                    {{prescription[0].prescription.appointmentPatientRecord.currentCodition}}
                                                                                                </p>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="row mb-5">
                                                                                            <div
                                                                                                class="col-12 text-center mb-4">
                                                                                                <h3
                                                                                                    class="mb-0 text-uppercase">
                                                                                                    Chỉ Định Dùng
                                                                                                    Thuốc</h3>
                                                                                            </div>
                                                                                            <div class="col-12 mb-3"
                                                                                                id="data-medince">
                                                                                                <div class="form-row">
                                                                                                    <!-- <p>Đơn thuốc được sử dụng trong: {{prescription[0].prescription.description}}</p> -->
                                                                                                </div>
                                                                                                <div
                                                                                                    class="custom-hr mb-3">
                                                                                                </div>
                                                                                            </div>
                                                                                            <div
                                                                                                class="col-12 medincine-result mb-3">
                                                                                                <table
                                                                                                    class="table table-hover">
                                                                                                    <thead>
                                                                                                        <tr>
                                                                                                            <th>STT
                                                                                                            </th>
                                                                                                            <th>Tên
                                                                                                                thuốc
                                                                                                            </th>
                                                                                                            <th
                                                                                                                class="text-right">
                                                                                                                Số
                                                                                                                lượng
                                                                                                            </th>
                                                                                                            <th
                                                                                                                class="text-right">
                                                                                                                Đơn
                                                                                                                vị
                                                                                                            </th>
                                                                                                            <th>Buổi
                                                                                                                uống
                                                                                                            </th>
                                                                                                            <th>Lời
                                                                                                                khuyên
                                                                                                            </th>
                                                                                                        </tr>
                                                                                                    </thead>
                                                                                                    <tbody>
                                                                                                        <tr
                                                                                                            ng-repeat="m in prescription">
                                                                                                            <th>{{$index+1}}
                                                                                                            </th>
                                                                                                            <td>{{m.medicines.medicineName}}
                                                                                                            </td>
                                                                                                            <td
                                                                                                                class="text-right">
                                                                                                                {{m.medicines.medicinesDosageAmount.amount*m.prescription.treatmentDuration.quantity
                                                                                                                }}
                                                                                                            </td>
                                                                                                            <td
                                                                                                                class="text-right">
                                                                                                                {{m.medicines.medicinesDosageUnit.unit}}
                                                                                                            </td>
                                                                                                            <td>{{m.frequency}}
                                                                                                            </td>
                                                                                                            <td>{{m.medicines.beforeEating
                                                                                                                ?
                                                                                                                'Uống
                                                                                                                trước
                                                                                                                khi
                                                                                                                ăn'
                                                                                                                :
                                                                                                                'Uống
                                                                                                                sau
                                                                                                                khi
                                                                                                                ăn'}}
                                                                                                            </td>
                                                                                                        </tr>
                                                                                                    </tbody>
                                                                                                </table>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="row mb-5">
                                                                                            <div class="col-md-7">
                                                                                                <p>Cộng khoản:
                                                                                                    <strong>{{prescription.length}}</strong>
                                                                                                </p>
                                                                                                <p>Số ngày uống:
                                                                                                    <strong>{{prescription[0].prescription.treatmentDuration.quantity}}
                                                                                                        ngày</strong>
                                                                                                </p>
                                                                                                <p>
                                                                                                    <strong><em>Tái
                                                                                                            khám xin
                                                                                                            mang
                                                                                                            theo đơn
                                                                                                            này</em></strong>
                                                                                                </p>
                                                                                            </div>
                                                                                            <div class="col-md-5">
                                                                                                <div class="text-right">
                                                                                                    <div
                                                                                                        class="mb-3 h6 text-center">
                                                                                                        <p
                                                                                                            class="text-secondary">
                                                                                                            Ngày {{
                                                                                                            day }}
                                                                                                            tháng {{
                                                                                                            month }}
                                                                                                            năm {{
                                                                                                            year }}
                                                                                                        </p>
                                                                                                        <p>Bác sĩ
                                                                                                            khám
                                                                                                            bệnh</p>
                                                                                                    </div>
                                                                                                    <div
                                                                                                        class="text-center">
                                                                                                        <img ng-src="{{app.doctor.signature}}"
                                                                                                            class="mb-3"
                                                                                                            alt="..."
                                                                                                            width="100"
                                                                                                            height="100">
                                                                                                        <p>{{app.doctor.fullName}}
                                                                                                        </p>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="card d-inline-flex mb-2">
                                                            <div class="card-body bg-light py-2 px-3">
                                                                Đã điệu trị các vấn đề
                                                                <strong>{{app.appointmentPatientRecord.currentCodition}}</strong>
                                                            </div>
                                                        </div>
                                                        </p>
                                                        <p class="text-muted">Bác sĩ điều trị:
                                                            {{app.doctor.fullName}}
                                                            <span class="badge badge-success"
                                                                ng-show="app.appointmentPatientRecord.reExamination!=''">Hẹn
                                                                tái khám:
                                                                {{app.appointmentPatientRecord.reExamination}}</span>
                                                        </p>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                                aria-label="Close">Đóng</button>
                        </div>
                    </div>
                </div>
            </div>



        </main>
    </div>
</div>